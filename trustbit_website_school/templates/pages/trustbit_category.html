{%- extends "trustbit_website_school/templates/includes/trustbit_base.html" -%}

{%- block title %}{{ category.label }} - {{ settings.store_name or "Trustbit Books & Stationery" }}{% endblock %}

{%- block page_content %}
<div class="kgs-page-container">
    <!-- Breadcrumb -->
    <div class="kgs-breadcrumb">
        <a href="/shop">Home</a> / 
        <a href="/shop/categories">Categories</a> / 
        <span>{{ category.label }}</span>
    </div>

    <!-- Page Header -->
    <div class="kgs-category-header kgs-glass">
        <div class="kgs-category-header-icon">
            {{ category.icon or "üì¶" }}
        </div>
        <div class="kgs-category-header-info">
            <h1>{{ category.label }}</h1>
            <p>{{ total }} products found</p>
        </div>
    </div>

    <!-- Filters & Sort -->
    <div class="kgs-toolbar">
        <div class="kgs-filter-tags">
            <span class="kgs-filter-tag active">All</span>
            <span class="kgs-filter-tag">In Stock</span>
            <span class="kgs-filter-tag">On Sale</span>
        </div>
        <div class="kgs-sort-dropdown">
            <label>Sort by:</label>
            <select onchange="location.href='?sort='+this.value">
                <option value="item_name" {% if sort_by == 'item_name' %}selected{% endif %}>Name (A-Z)</option>
                <option value="creation desc" {% if sort_by == 'creation desc' %}selected{% endif %}>Newest First</option>
                <option value="modified desc" {% if sort_by == 'modified desc' %}selected{% endif %}>Recently Updated</option>
            </select>
        </div>
    </div>

    <!-- Products Grid -->
    <div class="kgs-product-grid">
        {% for product in products %}
        <div class="kgs-product-card kgs-glass">
            <div class="kgs-product-image">
                {% if product.image %}
                <img src="{{ product.image }}" alt="{{ product.item_name }}">
                {% else %}
                üì¶
                {% endif %}
            </div>
            <div class="kgs-product-info">
                <span class="kgs-product-code">{{ product.item_code }}</span>
                <h4>{{ product.item_name }}</h4>
                {% if product.description %}
                <p class="kgs-product-desc">{{ product.description | truncate(60) }}</p>
                {% endif %}
            </div>
            <div class="kgs-product-footer">
                <div class="kgs-product-price-row">
                    <span class="kgs-product-price">‚Çπ{{ product.price | int }}</span>
                    <span class="kgs-stock-badge {{ 'in-stock' if product.stock > 0 else 'out-of-stock' }}">
                        {% if product.stock > 0 %}In Stock{% else %}Out of Stock{% endif %}
                    </span>
                </div>
                <button class="kgs-btn kgs-btn-primary kgs-btn-sm kgs-add-item-btn" 
                        data-item-code="{{ product.item_code }}"
                        {% if product.stock <= 0 %}disabled{% endif %}>
                    {% if product.stock > 0 %}+ Add to Cart{% else %}Out of Stock{% endif %}
                </button>
            </div>
        </div>
        {% else %}
        <div class="kgs-empty-state kgs-glass">
            <span>üì¶</span>
            <h3>No products found</h3>
            <p>This category doesn't have any products yet</p>
            <a href="/shop/categories" class="kgs-btn kgs-btn-primary">Browse Other Categories</a>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div class="kgs-pagination">
        {% if page > 1 %}
        <a href="?page={{ page - 1 }}&sort={{ sort_by }}" class="kgs-btn kgs-btn-outline">‚Üê Previous</a>
        {% endif %}
        
        <div class="kgs-page-numbers">
            {% for p in range(1, total_pages + 1) %}
                {% if p == page %}
                <span class="kgs-page-num active">{{ p }}</span>
                {% elif p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
                <a href="?page={{ p }}&sort={{ sort_by }}" class="kgs-page-num">{{ p }}</a>
                {% elif p == page - 3 or p == page + 3 %}
                <span class="kgs-page-dots">...</span>
                {% endif %}
            {% endfor %}
        </div>
        
        {% if page < total_pages %}
        <a href="?page={{ page + 1 }}&sort={{ sort_by }}" class="kgs-btn kgs-btn-outline">Next ‚Üí</a>
        {% endif %}
    </div>
    {% endif %}
</div>

<style>
.kgs-category-header {
    display: flex;
    align-items: center;
    gap: 24px;
    padding: 30px;
    margin-bottom: 30px;
}

.kgs-category-header-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 42px;
}

.kgs-category-header-info h1 {
    margin: 0 0 4px 0;
    color: #0f172a;
    font-size: 28px;
}

.kgs-category-header-info p {
    margin: 0;
    color: #64748b;
}

.kgs-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.kgs-filter-tags {
    display: flex;
    gap: 10px;
}

.kgs-filter-tag {
    background: rgba(255,255,255,0.9);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    color: #64748b;
    cursor: pointer;
    transition: all 0.2s;
}

.kgs-filter-tag.active, .kgs-filter-tag:hover {
    background: #7c3aed;
    color: #fff;
}

.kgs-sort-dropdown {
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(255,255,255,0.9);
    padding: 8px 16px;
    border-radius: 12px;
}

.kgs-sort-dropdown label {
    color: #64748b;
    font-size: 13px;
}

.kgs-sort-dropdown select {
    border: none;
    background: transparent;
    font-weight: 600;
    color: #0f172a;
    cursor: pointer;
}

.kgs-product-info {
    flex: 1;
}

.kgs-product-code {
    font-size: 11px;
    color: #94a3b8;
    font-family: monospace;
}

.kgs-product-desc {
    font-size: 13px;
    color: #64748b;
    margin: 8px 0 0 0;
    line-height: 1.4;
}

.kgs-product-footer {
    margin-top: auto;
}

.kgs-product-price-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.kgs-pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    margin-top: 40px;
}

.kgs-page-numbers {
    display: flex;
    gap: 8px;
}

.kgs-page-num {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255,255,255,0.9);
    border-radius: 10px;
    text-decoration: none;
    color: #0f172a;
    font-weight: 600;
    transition: all 0.2s;
}

.kgs-page-num.active, .kgs-page-num:hover {
    background: #7c3aed;
    color: #fff;
}

.kgs-page-dots {
    color: rgba(255,255,255,0.5);
}
</style>
{% endblock %}
