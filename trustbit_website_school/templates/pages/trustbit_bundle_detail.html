{%- extends "trustbit_website_school/templates/includes/trustbit_base.html" -%}

{%- block title %}{{ bundle.item_name }} - {{ settings.store_name or "Trustbit Books & Stationery" }}{% endblock %}

{%- block page_content %}
<div class="kgs-page-container">
    <!-- Breadcrumb -->
    <div class="kgs-breadcrumb">
        <a href="/shop">Home</a> / 
        <a href="/shop/bundles">Bundles</a> / 
        <span>{{ bundle.item_name }}</span>
    </div>

    <div class="kgs-bundle-detail">
        <!-- Left Column - Info -->
        <div class="kgs-bundle-info kgs-glass">
            <div class="kgs-bundle-detail-header">
                {% if bundle.school %}
                <span class="kgs-school-tag">{{ bundle.school }}{% if bundle.class %} ‚Ä¢ {{ bundle.class }}{% endif %}</span>
                {% endif %}
                
                <h1>{{ bundle.item_name }}</h1>
                <p class="kgs-bundle-code">Item Code: {{ bundle.item_code }}</p>
                
                {% if bundle.description %}
                <p class="kgs-bundle-desc">{{ bundle.description }}</p>
                {% endif %}
            </div>
            
            <!-- Bundle Stats -->
            <div class="kgs-bundle-stats">
                <div class="kgs-stat">
                    <span class="kgs-stat-value">{{ bundle.item_count }}</span>
                    <span class="kgs-stat-label">Items</span>
                </div>
                <div class="kgs-stat">
                    <span class="kgs-stat-value">‚Çπ{{ bundle.total_price | int | format_number }}</span>
                    <span class="kgs-stat-label">Total Value</span>
                </div>
                <div class="kgs-stat">
                    <span class="kgs-stat-value {% if bundle.availability.available_sets > 0 %}text-success{% else %}text-danger{% endif %}">
                        {{ bundle.availability.available_sets }}
                    </span>
                    <span class="kgs-stat-label">Sets Available</span>
                </div>
            </div>
            
            <!-- Out of Stock Warning -->
            {% if bundle.out_of_stock_items %}
            <div class="kgs-warning-banner">
                ‚ö†Ô∏è {{ bundle.out_of_stock_items | length }} item(s) currently out of stock and will be skipped
            </div>
            {% endif %}
            
            <!-- Add to Cart Button -->
            <div class="kgs-bundle-cta">
                <button class="kgs-btn kgs-btn-secondary kgs-btn-lg kgs-add-bundle-btn" 
                        data-item-code="{{ bundle.item_code }}"
                        {% if bundle.availability.available_sets <= 0 %}disabled{% endif %}>
                    üõí Add All Items to Cart
                </button>
                <p class="kgs-cta-note">
                    {% if bundle.availability.available_sets > 0 %}
                    Available items will be added individually - you can edit quantities in cart
                    {% else %}
                    This bundle is currently out of stock
                    {% endif %}
                </p>
            </div>
        </div>
        
        <!-- Right Column - Items List -->
        <div class="kgs-bundle-items kgs-glass">
            <h3>üìã Items in this Bundle ({{ bundle.item_count }})</h3>
            
            <div class="kgs-items-list">
                {% for item in bundle.items %}
                <div class="kgs-bundle-item {% if item.stock <= 0 %}out-of-stock{% endif %}">
                    <div class="kgs-item-image">
                        {% if item.image %}
                        <img src="{{ item.image }}" alt="{{ item.item_name }}">
                        {% else %}
                        üì¶
                        {% endif %}
                    </div>
                    <div class="kgs-item-info">
                        <div class="kgs-item-name">{{ item.item_name }}</div>
                        <div class="kgs-item-meta">
                            <span>Qty: {{ item.qty }} {{ item.uom }}</span>
                            <span class="kgs-item-stock {{ 'in-stock' if item.stock > 0 else 'no-stock' }}">
                                {% if item.stock > 0 %}
                                {{ item.stock }} available
                                {% else %}
                                Out of Stock
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    <div class="kgs-item-price">
                        <span class="kgs-item-rate">‚Çπ{{ item.rate | int }}</span>
                        <span class="kgs-item-amount">= ‚Çπ{{ item.amount | int }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Total -->
            <div class="kgs-bundle-total">
                <span>Total Bundle Value</span>
                <strong>‚Çπ{{ bundle.total_price | int | format_number }}</strong>
            </div>
        </div>
    </div>
</div>
{% endblock %}
