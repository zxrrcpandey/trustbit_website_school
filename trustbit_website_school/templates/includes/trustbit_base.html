{%- extends "templates/web.html" -%}

{%- block head_include %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
    .main-section { max-width: 100% !important; padding: 0 !important; }
    .page-content-wrapper { max-width: 100% !important; }
    body { background: linear-gradient(135deg, #7c3aed 0%, #a855f7 35%, #c084fc 65%, #e879f9 100%) !important; background-attachment: fixed !important; }

    /* Page Layout */
    .kgs-page-container { max-width: 1400px; margin: 0 auto; padding: 40px; }
    .kgs-page-header { text-align: center; margin-bottom: 32px; }
    .kgs-page-header h1 { color: #fff; font-size: 36px; font-weight: 800; margin: 0 0 8px 0; }
    .kgs-page-header p { color: rgba(255, 255, 255, 0.7); font-size: 16px; margin: 0; }

    /* Info Banner */
    .kgs-info-banner { display: flex !important; flex-direction: row !important; align-items: flex-start; gap: 16px; padding: 20px 24px; margin-bottom: 24px; border-radius: 16px; }
    .kgs-info-banner > span { font-size: 24px; line-height: 1; flex-shrink: 0; }
    .kgs-info-banner > div { flex: 1; }
    .kgs-info-banner strong { display: block; color: #0f172a; font-size: 15px; margin-bottom: 6px; }
    .kgs-info-banner p { color: #64748b; font-size: 14px; line-height: 1.6; margin: 0; }
    .kgs-info-banner p strong { display: inline; }

    /* Filters */
    .kgs-filters { display: flex !important; flex-direction: row !important; align-items: center; gap: 24px; padding: 20px 24px; margin-bottom: 32px; border-radius: 16px; flex-wrap: wrap; }
    .kgs-filter-group { display: inline-flex !important; flex-direction: row !important; align-items: center; gap: 10px; flex: 0 0 auto; }
    .kgs-filter-group label { font-size: 13px; font-weight: 600; color: #0f172a; white-space: nowrap; }
    .kgs-filter-group select { padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 14px; font-weight: 500; color: #0f172a; background: #fff; cursor: pointer; min-width: 140px; }

    /* Bundle Grid */
    .kgs-bundle-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 24px; margin-bottom: 40px; }

    /* Empty State */
    .kgs-empty-state { grid-column: 1 / -1; text-align: center; padding: 60px 40px; border-radius: 24px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.5); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); }
    .kgs-empty-state > span { font-size: 64px; display: block; margin-bottom: 16px; }
    .kgs-empty-state h3 { color: #0f172a; font-size: 20px; font-weight: 700; margin: 0 0 8px 0; }
    .kgs-empty-state p { color: #64748b; font-size: 14px; margin: 0; }

    /* Glass effect */
    .kgs-glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.5); border-radius: 24px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); }

    /* Main content wrapper - ensure proper stacking */
    .kgs-webshop { position: relative; z-index: 1; }
    .kgs-page-container { position: relative; z-index: 2; }

    /* Responsive */
    @media (max-width: 768px) {
        .kgs-page-container { padding: 20px; }
        .kgs-filters { flex-direction: column !important; align-items: stretch; }
        .kgs-filter-group { width: 100%; justify-content: space-between; }
        .kgs-bundle-grid { grid-template-columns: 1fr; }
    }
</style>
{% endblock %}

{%- block navbar %}
<!-- Empty navbar block - using custom header in content -->
{% endblock %}

{%- block content %}
<!-- Custom Header -->
<header class="kgs-header kgs-glass-dark">
    <div class="kgs-header-inner" style="display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto;">
        <a href="/shop" class="kgs-logo">
            <div class="kgs-logo-icon">ğŸ“š</div>
            <div class="kgs-logo-text">
                <h1>{{ settings.store_name or "School Supplies Store" }}</h1>
                <p>Your Complete School Shop</p>
            </div>
        </a>

        <nav class="kgs-nav">
            <a href="/shop" class="kgs-nav-link {% if active_page == 'home' %}active{% endif %}">ğŸ  Home</a>
            <a href="/shop/bundles" class="kgs-nav-link {% if active_page == 'bundles' %}active{% endif %}">ğŸ“¦ Bundles</a>
            <a href="/shop/categories" class="kgs-nav-link {% if active_page == 'categories' %}active{% endif %}">ğŸ“‚ Categories</a>
            <a href="/shop/announcements" class="kgs-nav-link {% if active_page == 'announcements' %}active{% endif %}">ğŸ“¢ News</a>
            <a href="/shop/orders" class="kgs-nav-link {% if active_page == 'orders' %}active{% endif %}">ğŸ“‹ Orders</a>
            <a href="/shop/about" class="kgs-nav-link {% if active_page == 'about' %}active{% endif %}">â„¹ï¸ About</a>
            <a href="/shop/contact" class="kgs-nav-link {% if active_page == 'contact' %}active{% endif %}">ğŸ“ Contact</a>
        </nav>

        <div class="kgs-search-container">
            <div class="kgs-search-box">
                <span>ğŸ”</span>
                <input type="text" id="kgs-search-input" placeholder="Search products...">
            </div>
            <div id="kgs-search-dropdown" class="kgs-search-dropdown" style="display: none;"></div>
        </div>

        <a href="/cart" class="kgs-cart-btn">ğŸ›’ Cart <span class="kgs-cart-count" id="kgs-cart-count" style="display: none;">0</span></a>
    </div>
</header>

<!-- Main Content -->
<div class="kgs-webshop">
    {% block page_content %}{% endblock %}
</div>

<!-- Custom Footer -->
<footer class="kgs-footer kgs-glass-dark">
    <div class="kgs-footer-grid" style="max-width: 1400px; margin: 0 auto;">
        <div>
            <div class="kgs-footer-logo" style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
                <span style="font-size: 28px;">ğŸ“š</span>
                <span style="color: #fff; font-weight: 700;">{{ settings.store_name or "School Supplies" }}</span>
            </div>
            <p>{{ settings.footer_about_text or "Your trusted partner for all school supplies." }}</p>
        </div>
        <div>
            <h4>Quick Links</h4>
            <a href="/shop">Home</a>
            <a href="/shop/bundles">Product Bundles</a>
            <a href="/shop/categories">Categories</a>
            <a href="/shop/about">About Us</a>
            <a href="/shop/contact">Contact</a>
        </div>
        <div>
            <h4>Categories</h4>
            {% for cat in categories[:5] if categories %}
            <a href="/shop/category/{{ cat.name | urlencode }}">{{ cat.icon or "ğŸ“¦" }} {{ cat.item_group_name }}</a>
            {% endfor %}
        </div>
        <div>
            <h4>Contact Us</h4>
            <p>ğŸ“ {{ settings.store_address or "Your Address Here" }}</p>
            <p>ğŸ“ {{ settings.phone or "Your Phone" }}</p>
            <p>âœ‰ï¸ {{ settings.email or "email@example.com" }}</p>
            <p>â° {{ settings.store_hours or "Mon-Sat: 9AM - 8PM" }}</p>
        </div>
    </div>
    <div class="kgs-footer-bottom">
        {{ settings.copyright_text or "Â© 2024 All rights reserved." }} | Powered by ERPNext
    </div>
</footer>
{% endblock %}

{%- block footer %}
<!-- Empty footer block to prevent default Frappe footer -->
{% endblock %}

{%- block script %}
<script>
frappe.ready(function() {
    // Only load cart for logged in users
    if (frappe.session.user && frappe.session.user !== 'Guest') {
        frappe.call({
            method: 'webshop.webshop.shopping_cart.cart.get_cart_quotation',
            callback: function(r) {
                if (r.message && r.message.doc && r.message.doc.items) {
                    var count = r.message.doc.items.reduce((sum, item) => sum + item.qty, 0);
                    if (count > 0) {
                        $('#kgs-cart-count').text(count).show();
                        $('.kgs-cart-btn').addClass('has-items');
                    }
                }
            },
            error: function() {
                // Silently ignore cart errors
            }
        });
    }
});
</script>
{% endblock %}
